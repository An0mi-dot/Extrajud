<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extrator PJE - TJBA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="assets/theme.css">

    <style>
        :root {
            /* Local specific colors */
            --success-color: #198754;
            --danger-color: #dc3545;
            --log-bg: #1e1e1e;
            --log-text: #00ff9d;
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        body.loaded { opacity: 1; }

        /* Sidebar similar to extrator_projudi */
        .sidebar {
            width: 280px;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.02);
            z-index: 10;
            overflow-y: auto;
        }

        /* Typography */
        h1, h2, h3, .brand, .modal-title {
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .brand {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-back {
            background: none;
            border: 1px solid var(--border-color);
            color: #666;
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }
        .btn-back:hover {
            background-color: #f8f9fa;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .label-section {
            font-size: 11px;
            font-weight: 700;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'JetBrains Mono', monospace;
        }

        button.btn-action {
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        button.btn-action:active { transform: scale(0.98); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        #btnStart { background-color: var(--primary-color); color: white; }
        #btnStart:hover:not(:disabled) { background-color: var(--primary-hover); }

        #btnStop { background-color: white; color: var(--danger-color); border: 1px solid var(--danger-color); }
        #btnStop:hover:not(:disabled) { background-color: #fff5f5; }

        .btn-secondary {
            background-color: #eef2ff; color: #4338ca;
            font-size: 13px; padding: 10px;
        }
        .btn-secondary:hover { background-color: #e0e7ff; }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
            min-width: 0;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        @media (max-width: 900px) {
            .sidebar {
                width: 220px;
                padding: 15px;
            }
        }

        .info-card {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            font-size: 13px;
            color: #555;
            line-height: 1.5;
        }
        
        .alert-box {
            background: #fff7ed;
            border-left: 4px solid #f59e0b;
            color: #92400e;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 5px;
        }

        /* Logs Console (Standardized) */
        .logs-wrapper {
            flex: 1;
            background-color: var(--log-bg);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .logs-header {
            background-color: #2d2d2d;
            padding: 8px 15px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .dots { display: flex; gap: 6px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .red { background: #ff5f56; } .yellow { background: #ffbd2e; } .green { background: #27c93f; }
        
        .log-title-text { color: #aaa; font-size: 12px; font-family: 'Inter', sans-serif; margin-left:10px;}

        #logs {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: #d4d4d4;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .log-entry { margin-bottom: 4px; padding-left: 8px; border-left: 3px solid transparent; }
        .log-info { border-left-color: #3b82f6; }
        .log-success { border-left-color: #10b981; color: #a7f3d0; }
        .log-warning { border-left-color: #f59e0b; color: #fde68a; }
        .log-error { border-left-color: #ef4444; color: #fca5a5; }

        /* Utilities */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        /* Modal (Standard) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 12px; width: 400px;
            box-shadow: 0 20px 25px rgba(0,0,0,0.1);
        }
        .modal-input { width: 100%; padding: 10px; margin-top:10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .modal-actions { margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }
        
    </style>
</head>
<body>
    <div class="sidebar animate fade-in-up">
        <div class="brand">
            <i class="fas fa-gavel"></i> EXTRATOR PJE
        </div>
        
        <button class="btn-back" onclick="window.location.href='hub_servicos.html'">
            <i class="fas fa-arrow-left"></i> Voltar ao Hub
        </button>
        <button id="btn-settings" class="btn-back" style="margin-top: -10px;">
             <i class="fa-solid fa-gear" style="margin-right: 6px;"></i> Configurações
        </button>

        <div class="control-group">
            <div class="label-section">Credenciais</div>
            <input type="text" id="inp-login" placeholder="Login (CPF)" value="05997307573" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:13px; color:#555; background:#fff; font-family:'Inter',sans-serif; margin-bottom: 5px; box-sizing: border-box;">
            <input type="password" id="inp-password" placeholder="Senha" value="neocoelba@10" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:13px; color:#555; background:#fff; font-family:'Inter',sans-serif; box-sizing: border-box;">
        </div>

        <div class="control-group">
            <div class="label-section">Automação</div>
            <button id="btnStart" class="btn-action" onclick="startAutomation()">
                <i class="fas fa-play"></i> INICIAR SERVIÇO
            </button>
            <button id="btnStop" class="btn-action" onclick="stopAutomation()" style="display:none;">
                <i class="fas fa-stop"></i> PARAR SERVIÇO
            </button>
            <button id="btnSkip" class="btn-action btn-secondary" onclick="skipAutomation()" style="display:none; border:1px solid #ccc; color:#555;">
                <i class="fas fa-forward"></i> PULAR ETAPA
            </button>
        </div>



        <div class="control-group" style="margin-top:auto;">
            <div class="label-section">Destino dos Arquivos</div>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <input type="text" id="inp-output-dir" readonly placeholder="Pasta Padrão" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; color:#555; background:#f9f9f9; font-family:'Inter',sans-serif;">
                <button id="btn-select-dir" style="padding:0 8px; width:40px; border:1px solid #ccc; background:#eee; cursor:pointer; border-radius:4px;" title="Selecionar Pasta">
                    <i class="fas fa-folder-open" style="color:#555; font-size:12px;"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="main-content animate fade-in-up delay-200">
        <!-- Banner Dev -->
        <div class="alert-box">
            <strong>EM DESENVOLVIMENTO:</strong> Funcionalidades de extração em fase beta. Verifique sempre os arquivos gerados.
        </div>

        <div class="info-card">
            <strong>Fluxo de Trabalho:</strong> O robô abrirá o navegador PJE. Realize o login manualmente. Após o login, a navegação será automática para extração de expedientes (Citações/Intimações) de 1º e 2º Grau.
        </div>

        <div class="logs-wrapper">
            <div class="logs-header">
                <div style="display:flex; align-items:center;">
                    <div class="dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
                    <span class="log-title-text">TERMINAL DE EXECUÇÃO</span>
                </div>
                <div style="display:flex; gap:8px;">
                    <button id="btn-copy-log" title="Copiar Logs" style="background:none;border:0;color:#aaa;cursor:pointer;font-family:'Inter', sans-serif;font-size:11px;padding:4px 8px;display:flex;align-items:center;gap:4px;border-radius:4px;">
                        <i class="fa-regular fa-copy"></i> Copiar
                    </button>
                    <button id="btn-download-log" title="Baixar Logs (TXT)" style="background:none;border:0;color:#aaa;cursor:pointer;font-family:'Inter', sans-serif;font-size:11px;padding:4px 8px;display:flex;align-items:center;gap:4px;border-radius:4px;">
                        <i class="fa-solid fa-download"></i> Baixar
                    </button>
                    <button id="btn-clear-log" title="Limpar Logs" style="background:none;border:0;color:#aaa;cursor:pointer;font-family:'Inter', sans-serif;font-size:11px;padding:4px 8px;display:flex;align-items:center;gap:4px;border-radius:4px;">
                        <i class="fa-solid fa-trash-can"></i> Limpar
                    </button>
                </div>
            </div>
            <div id="logs"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="dynamicModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <div id="modalTitle" class="modal-title" style="font-size:18px;">Título</div>
                <button id="modalCloseX" style="background:none; border:none; font-size:20px; cursor:pointer; color:#999;">&times;</button>
            </div>
            <div id="modalBody" style="font-size:14px; color:#444;"></div>
            <div class="modal-actions">
                <button id="modalCancelBtn" class="btn-action btn-secondary" style="background:#f1f1f1; color:#555;">Cancelar</button>
                <button id="modalConfirmBtn" class="btn-action" style="background:var(--primary-color); color:#fff;">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        const btnStart = document.getElementById('btnStart');
        const btnStop = document.getElementById('btnStop');
        const logArea = document.getElementById('logs'); 
        const modal = document.getElementById('dynamicModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalConfirmBtn = document.getElementById('modalConfirmBtn');
        const modalCancelBtn = document.getElementById('modalCancelBtn');

        // --- Page Transitions ---
        window.addEventListener('DOMContentLoaded', () => { document.body.classList.add('loaded'); });
        document.querySelector('.btn-back').addEventListener('click', (e) => {
            e.preventDefault();
            document.body.classList.remove('loaded');
            setTimeout(() => { window.location.href = 'hub_servicos.html'; }, 400); 
        });

        // --- State & Logs Persistence ---
        let fullLogs = [];
        let saveTimer = null;
        const MAX_SAVED_LOGS = 300;

        function scheduleSave() {
            if (saveTimer) clearTimeout(saveTimer);
            saveTimer = setTimeout(() => {
                try {
                    const state = ipcRenderer.invoke('load-app-state'); 
                    (async () => {
                        const cur = await state;
                        cur.pje = cur.pje || {};
                        cur.pje.logs = fullLogs.slice(-MAX_SAVED_LOGS);
                        cur.pje.isRunning = (btnStop.style.display !== 'none');
                        cur.pje.scrollTop = logArea.scrollTop;
                        cur.pje.outputDir = (document.getElementById('inp-output-dir') ? document.getElementById('inp-output-dir').value : '');
                        ipcRenderer.send('save-app-state', cur);
                    })();
                } catch (e) { console.error('scheduleSave error', e); }
            }, 800);
        }

        async function restoreState() {
            try {
                const state = await ipcRenderer.invoke('load-app-state');
                const s = state && state.pje ? state.pje : null;
                if (!s) return;
                if (Array.isArray(s.logs)) {
                    s.logs.forEach(l => addLog(l.msg || l, l.type ? ('log-'+l.type) : 'log-info', false));
                    if (s.scrollTop) logArea.scrollTop = s.scrollTop;
                }
                if (s.outputDir && document.getElementById('inp-output-dir')) {
                    document.getElementById('inp-output-dir').value = s.outputDir;
                }
                if (s.isRunning) {
                    btnStart.style.display = 'none'; btnStop.style.display = 'flex';
                }
            } catch (e) { console.error('Error restoring PJE state', e); }
        }

        // Listeners
        ipcRenderer.on('log-message', (event, data) => {
            if (typeof data === 'string') addLog(data, 'log-info');
            else {
                let cssClass = 'log-info';
                if(data.type === 'success') cssClass = 'log-success';
                else if(data.type === 'error') cssClass = 'log-error';
                else if(data.type === 'warning') cssClass = 'log-warning';
                addLog(`> ${data.msg}`, cssClass);
            }
        });

        ipcRenderer.on('automation-status', (event, status) => {
            if (status === true) { 
                btnStart.style.display = 'none'; 
                btnStop.style.display = 'flex'; 
                btnSkip.style.display = 'flex';
                btnStop.disabled = false;
                btnSkip.disabled = false;
            }
            else if (status === false) { 
                btnStart.style.display = 'flex'; 
                btnStop.style.display = 'none'; 
                btnSkip.style.display = 'none';
            }
            else if (status === 'stopping') { 
                btnStop.disabled = true; 
                btnSkip.disabled = true;
            }
            scheduleSave();
        });

        window.addEventListener('DOMContentLoaded', () => { restoreState(); });

        ipcRenderer.on('script-finished', async () => {
             btnStart.style.display = 'flex';
             btnStop.style.display = 'none';
             btnSkip.style.display = 'none';
             btnStop.disabled = false;
             addLog('[DONE] Execução finalizada.', 'log-success');
             scheduleSave();

             // Notifications Logic (Sound/Toast)
             try {
                const config = await ipcRenderer.invoke('get-general-config');
                
                if (config.notificationFinish) {
                    new Notification('Extratjud', { body: 'Serviço PJE finalizado com sucesso.', icon: 'assets/logo.png' });
                }

                if (config.soundFinish) {
                    // Simple Web Audio Chime
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
                    osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1); // A5
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.8);
                }
             } catch(e) { console.error('Notification Error', e); }
        });

        ipcRenderer.on('request-pje-input', (event, data) => { showModal(data); });

        function addLog(msg, typeClass, doSave = true) {
            const div = document.createElement('div');
            div.className = `log-entry ${typeClass}`;
            div.textContent = msg;
            logArea.appendChild(div);
            logArea.scrollTop = logArea.scrollHeight;
            fullLogs.push({ timestamp: new Date().toISOString(), msg, type: typeClass.replace(/^log-/, '') });
            if (fullLogs.length > 1000) fullLogs.shift();
            if (doSave) scheduleSave();
        }

        // Directory Selector
        function attachSelectDirHandler() {
            const btn = document.getElementById('btn-select-dir');
            if(!btn) return;
            btn.addEventListener('click', async () => {
                const dir = await ipcRenderer.invoke('dialog:openDirectory');
                if (dir) {
                    document.getElementById('inp-output-dir').value = dir;
                    scheduleSave();
                }
            });
        }
        if (document.readyState === 'loading') window.addEventListener('DOMContentLoaded', attachSelectDirHandler);
        else attachSelectDirHandler();

        function startAutomation() {
            logArea.innerHTML = '';
            btnStart.style.display = 'none';
            btnStop.style.display = 'flex';
            btnSkip.style.display = 'flex';
            addLog('>>> Iniciando Serviço PJE...', 'log-info');
            scheduleSave();
            const outputDir = document.getElementById('inp-output-dir').value || '';
            const login = document.getElementById('inp-login').value || '';
            const password = document.getElementById('inp-password').value || '';
            ipcRenderer.send('run-pje-script', { outputDir, login, password });
        }

        function stopAutomation() {
            ipcRenderer.send('stop-script');
            btnStop.disabled = true; 
            btnSkip.disabled = true;
            addLog('!!! Solicitando parada...', 'log-warning');
            scheduleSave();
        }

        function skipAutomation() {
            ipcRenderer.send('skip-pje-script');
            addLog('>> Pulando etapa atual...', 'log-warning');
        }

        function initLogTools() {
            const btnCopy = document.getElementById('btn-copy-log');
            const btnDown = document.getElementById('btn-download-log');
            const btnClear = document.getElementById('btn-clear-log');

            if(btnCopy) btnCopy.addEventListener('click', () => {
                const textToCopy = fullLogs.map(l => `[${l.timestamp}] [${l.type ? l.type.toUpperCase() : 'INFO'}] ${l.msg}`).join('\n');
                navigator.clipboard.writeText(textToCopy).then(() => {
                    const original = btnCopy.innerHTML;
                    btnCopy.innerHTML = '<i class="fa-solid fa-check"></i> Copiado!';
                    setTimeout(() => btnCopy.innerHTML = original, 2000);
                });
            });

            if(btnDown) btnDown.addEventListener('click', () => {
                const textContent = fullLogs.map(l => `[${l.timestamp}] [${l.type ? l.type.toUpperCase() : 'INFO'}] ${l.msg}`).join('\n');
                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url;
                a.download = `pje_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
                document.body.appendChild(a); a.click();
                document.body.removeChild(a); window.URL.revokeObjectURL(url);
            });

            if(btnClear) btnClear.addEventListener('click', () => {
                logArea.innerHTML = '';
                fullLogs = [];
                addLog('Logs limpos pelo usuário.', 'log-info');
            });
        }
        initLogTools();

        // Modal Logic Refactored
        function showModal(data) {
            modal.style.display = 'flex';
            modalTitle.innerText = data.title;
            modalBody.innerHTML = '';
            
            // Basic Confirm
             modalConfirmBtn.onclick = () => {
                let result = true;
                const input = document.getElementById('modalInputVal');
                if (input) result = input.value;
                modal.style.display = 'none';
                ipcRenderer.send('pje-input-response', result);
            };

            // Cancel
            modalCancelBtn.onclick = () => {
                 modal.style.display = 'none';
                 ipcRenderer.send('pje-input-response', false);
            };
            const closeX = document.getElementById('modalCloseX');
            if(closeX) closeX.onclick = modalCancelBtn.onclick;

            if (data.type === 'number') {
                const p = document.createElement('p'); p.innerText = data.message;
                const inp = document.createElement('input'); 
                inp.type = 'number'; inp.className = 'modal-input'; inp.id = 'modalInputVal';
                inp.value = '1'; if(data.max) inp.max = data.max;
                modalBody.append(p, inp);
            } else if (data.type === 'confirm') {
                const p = document.createElement('p'); p.innerText = data.message;
                modalBody.append(p);
            } else if (data.type === 'select') {
                const p = document.createElement('p'); p.innerText = data.message;
                const sel = document.createElement('select'); sel.className = 'modal-input'; sel.id = 'modalInputVal';
                data.options.forEach(o => {
                    const opt = document.createElement('option'); opt.value = o.value; opt.innerText = o.label; sel.appendChild(opt);
                });
                modalBody.append(p, sel);
            }
        }



    </script>
    <!-- Settings Modal -->
    <div id="modal-settings" class="settings-modal-overlay">
        <div class="settings-modal-content">
            <div class="settings-modal-header">
                <h2><i class="fa-solid fa-sliders"></i> Configurações</h2>
                <button id="btn-close-settings" class="settings-close-btn">&times;</button>
            </div>
            
            <div class="settings-modal-body">
                <div class="settings-sidebar">
                    <button class="settings-tab active" data-tab="geral"><i class="fa-solid fa-wrench"></i> Geral</button>
                    <button class="settings-tab" data-tab="logs"><i class="fa-solid fa-file-lines"></i> Logs</button>
                    <button class="settings-tab" data-tab="sobre"><i class="fa-solid fa-circle-info"></i> Sobre</button>
                </div>
                
                <div class="settings-content-area">
                    
                    <!-- ABAS DE CONTEÚDO -->
                    <div id="tab-geral" class="settings-tab-pane active">
                        <h3 class="settings-section-title">Comportamento da Janela</h3>
                        <p class="settings-section-desc">Personalize como o Extratjud interage com seu desktop.</p>

                        <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 12px;">
                            <label class="checkbox-container" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                                <input type="checkbox" id="chk-minimize-tray" style="width:16px; height:16px;">
                                <span style="font-size:13px; color:var(--text-color);">Minimizar para a bandeja ao fechar</span>
                            </label>
                            
                            <label class="checkbox-container" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                                <input type="checkbox" id="chk-always-top" style="width:16px; height:16px;">
                                <span style="font-size:13px; color:var(--text-color);">Manter janela sempre no topo</span>
                            </label>
                            
                            <h3 class="settings-section-title" style="margin-top: 15px;">Notificações</h3>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <label class="checkbox-container" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                                    <input type="checkbox" id="chk-sound-finish" style="width:16px; height:16px;">
                                    <span style="font-size:13px; color:var(--text-color);">Emitir som ao finalizar</span>
                                </label>
                                
                                <label class="checkbox-container" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                                    <input type="checkbox" id="chk-notification-finish" style="width:16px; height:16px;">
                                    <span style="font-size:13px; color:var(--text-color);">Notificação do Windows</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="tab-logs" class="settings-tab-pane">
                         <h3 class="settings-section-title">Gerenciamento de Logs</h3>
                         <p class="settings-section-desc">Centralize os arquivos de registro para facilitar o suporte.</p>

                        <div class="settings-item">
                            <label class="settings-label">Diretório Global de Logs</label>
                            <div class="settings-input-group">
                                <input type="text" id="inp-global-log" readonly placeholder="Selecione uma pasta..." class="settings-input">
                                <button id="btn-sel-log-dir" class="settings-btn-icon"><i class="fa-solid fa-folder-open"></i></button>
                            </div>
                            <small style="display:block; margin-top:5px; color:var(--text-secondary);">Todos os robôs salvarão seus relatórios de execução nesta pasta.</small>
                        </div>
                    </div>

                    <div id="tab-sobre" class="settings-tab-pane">
                        <div style="text-align:center; padding:20px;">
                            <img src="assets/logo.png" style="height:80px; margin-bottom:15px; filter:drop-shadow(0 4px 6px rgba(0,0,0,0.1));">
                            <h3 style="margin:0; color:var(--primary-color);">EXTRATJUD</h3>
                            <p style="margin:5px 0; color:var(--text-secondary);">Versão 1.2.4</p>
                            <hr style="margin:20px 0; border:0; border-top:1px solid var(--border-color);">
                            <p style="font-size:13px; color:var(--text-secondary); line-height: 1.6; text-align: left; padding: 0 10px;">
                                Desenvolvido por <strong>João Guilherme Almeida Viana</strong><br>
                                Neoenergia Coelba &copy; 2026<br><br>
                                Solução de automação para extração e gestão de processos jurídicos (Projudi/PJE).
                                <br><br>
                                <strong>Nota Técnica:</strong> O Extratjud não utiliza APIs oficiais dos serviços judiciais devido à indisponibilidade de acesso público. A ferramenta opera automatizando processos manuais com auxílio de Inteligência Artificial para maior rapidez e eficiência.
                            </p>
                        </div>
                    </div>

                </div>
            </div>

            <div class="settings-modal-footer">
                <button id="btn-save-settings" class="settings-btn-primary"><i class="fa-solid fa-check"></i> Salvar Alterações</button>
            </div>
        </div>
    </div>

    <style>
        /* Modal Styles Refined (Scoped for Settings) */
        .settings-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: settingsFadeIn 0.2s ease-out;
        }

        .settings-modal-content {
            background: var(--card-bg);
            width: 700px;
            height: 500px;
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            animation: settingsSlideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .settings-modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-color);
        }
        .settings-modal-header h2 { margin: 0; font-size: 20px; color: var(--text-color); display:flex; gap:10px; align-items:center; }
        .settings-close-btn { background: none; border: none; font-size: 24px; color: var(--text-secondary); cursor: pointer; transition: color 0.2s; }
        .settings-close-btn:hover { color: var(--error-color, #ef4444); }

        .settings-modal-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .settings-sidebar {
            width: 200px;
            background: var(--bg-color);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
        }

        .settings-tab {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 25px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .settings-tab:hover { background: rgba(0,0,0,0.03); color: var(--primary-color); }
        .settings-tab.active {
            background: rgba(var(--primary-rgb, 16, 185, 129), 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }
        .settings-tab i { margin-right: 10px; width: 20px; text-align: center; }

        .settings-content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .settings-tab-pane { display: none; animation: settingsFadeIn 0.3s ease; }
        .settings-tab-pane.active { display: block; }

        .settings-section-title { margin-top: 0; font-size: 18px; color: var(--text-color); margin-bottom: 5px; }
        .settings-section-desc { font-size: 14px; color: var(--text-secondary); margin-bottom: 25px; }

        .settings-item { margin-bottom: 25px; }
        .settings-label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; color: var(--text-color); }
        .settings-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: inherit;
        }
        .settings-input-group { display: flex; gap: 8px; }
        .settings-btn-icon {
            padding: 0 15px;
            background: var(--card-icon-bg);
            color: var(--card-icon-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .settings-btn-icon:hover { background: var(--primary-color); color: white; }

        .settings-modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-color);
            display: flex;
            justify-content: flex-end;
        }
        .settings-btn-primary {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .settings-btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .settings-btn-primary:active { transform: translateY(0); }

        @keyframes settingsFadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes settingsSlideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>

    <script>
        (function() {
            // Safer require for electron
            let ipcRenderer = null;
            try {
                if (typeof require === 'function') {
                    const electron = require('electron');
                    ipcRenderer = electron && electron.ipcRenderer;
                }
            } catch(e){}

            // Use global if still null
            if (!ipcRenderer && window.ipcRenderer) ipcRenderer = window.ipcRenderer;

            if (!ipcRenderer) {
                console.warn('Configurações: ipcRenderer indisponível.');
                return;
            }
            
            // --- Settings Logic ---
            const modalSettings = document.getElementById('modal-settings');
            const inpGlobalLog = document.getElementById('inp-global-log');
            const chkMinimize = document.getElementById('chk-minimize-tray');
            const chkAlwaysTop = document.getElementById('chk-always-top');
            const chkSoundFinish = document.getElementById('chk-sound-finish');
            const chkNotificationFinish = document.getElementById('chk-notification-finish');

            const tabs = document.querySelectorAll('.settings-tab');
            const panes = document.querySelectorAll('.settings-tab-pane'); 

            // Tab Switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class
                    tabs.forEach(t => t.classList.remove('active'));
                    panes.forEach(p => p.classList.remove('active'));
                    // Add active class
                    tab.classList.add('active');
                    const targetId = 'tab-' + tab.getAttribute('data-tab');
                    const targetPane = document.getElementById(targetId);
                    if(targetPane) targetPane.classList.add('active');
                });
            });

            const btnSettings = document.getElementById('btn-settings');
            if (btnSettings) {
                btnSettings.addEventListener('click', async () => {
                    // Load current state
                    try {
                        const state = await ipcRenderer.invoke('load-app-state');
                        if (state && state.globalLogDir) {
                            inpGlobalLog.value = state.globalLogDir;
                        }

                        // Load General Config
                        const genConfig = await ipcRenderer.invoke('get-general-config');
                        if (chkMinimize) chkMinimize.checked = genConfig.minimizeToTray || false;
                        if (chkAlwaysTop) chkAlwaysTop.checked = genConfig.alwaysOnTop || false;
                        if (chkSoundFinish) chkSoundFinish.checked = genConfig.soundFinish || false;
                        if (chkNotificationFinish) chkNotificationFinish.checked = genConfig.notificationFinish || false;
                    } catch(e) { console.error('Erro ao carregar estado:', e); }
                    modalSettings.style.display = 'flex';
                });
            }

            const btnCloseSettings = document.getElementById('btn-close-settings');
            if (btnCloseSettings) {
                btnCloseSettings.addEventListener('click', () => {
                     modalSettings.style.display = 'none';
                });
            }

            const btnSelLogDir = document.getElementById('btn-sel-log-dir');
             if (btnSelLogDir) {
                btnSelLogDir.addEventListener('click', async () => {
                     const dir = await ipcRenderer.invoke('dialog:openDirectory');
                     if (dir) {
                         inpGlobalLog.value = dir;
                     }
                });
             }

            const btnSaveSettings = document.getElementById('btn-save-settings');
            if (btnSaveSettings) {
                btnSaveSettings.addEventListener('click', async () => {
                     try {
                        const state = await ipcRenderer.invoke('load-app-state') || {};
                        state.globalLogDir = inpGlobalLog.value;
                        ipcRenderer.send('save-app-state', state);

                        // Save General Config
                        await ipcRenderer.invoke('set-general-config', {
                            minimizeToTray: chkMinimize ? chkMinimize.checked : false,
                            alwaysOnTop: chkAlwaysTop ? chkAlwaysTop.checked : false,
                            soundFinish: chkSoundFinish ? chkSoundFinish.checked : false,
                            notificationFinish: chkNotificationFinish ? chkNotificationFinish.checked : false
                        });

                        modalSettings.style.display = 'none';
                        // Feedback visual opcional
                        alert('Configurações salvas com sucesso.');
                     } catch(e) {
                         alert('Erro ao salvar: ' + e.message);
                     }
                });
            }

            // Close on outside click
            if (modalSettings) {
                modalSettings.addEventListener('click', (e) => {
                    if (e.target === modalSettings) modalSettings.style.display = 'none';
                });
            }
        })();
    </script>
</body>
</html>